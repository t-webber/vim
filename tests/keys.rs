#![allow(non_snake_case)]

macro_rules! buffer_tests {
    ($mod:ident, $($name:ident: $keymaps:literal => $output:literal,)*) => {
        mod $mod {
            use vim_buffer::Buffer;
            $(
                #[test]
                fn $name() {
                    let mut buffer = Buffer::default();
                    buffer.update_from_string($keymaps).unwrap();
                    assert_eq!(
                        buffer.as_content(),
                        $output,
                        "Keys: \x1b[35m{}\x1b[0m",
                        $keymaps
                    );
                }
            )*
        }
    };
}

buffer_tests!(insert,

backspace: "ia<BS><BS>bcd<BS>" => "bc",
arrows: "iabc<Left>d<Right>e" => "abdce",

);

buffer_tests!(normal,

backspace: "ia<Esc><BS><BS>ibcd<Esc><BS>ie" => "becda",
a: "ia<Esc>ab" => "ab",
i: "ia<Esc>ib" => "ba",
I: "i  ab<Esc>Ic" => "  cab",
I_no_space: "iab<Esc>Ic" => "cab",
I_empty_line: "i   <Esc>Ia" => "   a",
A: "iabc<Esc>Ad" => "abcd",
A_empty_line: "i   <Esc>Aa" => "   a",
arrows: "iabc<Esc><Left>id<Esc><Right>ae" => "adbec",
h_l: "iabc<Esc>hid<Esc>lae" => "adbec",
_0: "i  abc<Esc>0id" => "d  abc",
dollar: "i abc <Esc>0id<Esc>$ae" => "d abc e",
caret: "i  abc<Esc>^id" => "  dabc",
f_not_found: "iabc<Esc>0<Right>fzid" => "adbc",
t_not_found: "iabc<Esc>0<Right>tzid" => "adbc",
f: "iabcabc<Esc>0fcad<Esc>fcae" => "abcdabce",
t: "iabcabc<Esc>0tcad<Esc>ltcae" => "abdcabec",
F_not_found: "iabc<Esc><Left>Fzad" => "abdc",
T_not_found: "iabc<Esc><Left>Tzad" => "abdc",
F: "iabcabc<Esc>Faad<Esc>hFaae" => "aebcadbc",
simple_F: "iabc<Esc>Fbid" => "adbc",
T: "iabcabc<Esc>Taad<Esc>hhTaae" => "abecabdc",
x: "iabcd<Esc>x<Left>x" => "ac",
x_empty: "x" => "",
X: "iabcd<Esc>X<Left>X" => "bd",
s: "iabcd<Esc>se<Esc>hsf" => "abfe",
S: "iabcdef<Esc>hhhSghij" => "ghij",
r: "iabcd<Esc>Fbre" => "aecd",
r_empty: "rx" => "",

w: "ibc   def::(Bl<Esc>0wa.<Esc>lwa.<Esc>lwa.<Esc>lwa." => "bc   d.ef:.:(B.l.",
w_end_space: "iab <Esc>0wa." => "ab .",
w_end_symbol: "i)))<Esc>0wa." => "))).",

W: "i  ab  cd<Esc>0Wiz<Esc>lWiz<Esc>lWaz" => "  zab  zcdz",
W_empty: "i    <Esc>0Waz" => "    z",

b: "i)))) ef<Esc>biz<Esc>biz" => "z)))) zef",
b_word: "iab<Esc>biz" => "zab",
b_word_space: "iab <Esc>biz" => "zab ",
b_leading_space: "i ab <Esc>biz" => " zab ",
b_symbols: "iab(:) <Esc>biz" => "abz(:) ",
b_leading_symbols: "i(:)<Esc>biz" => "z(:)",
b_spaces: "i  <Esc>biz" => "z  ",
b_single_char: "i a b<Esc>biz" => " za b",

B_empty: "i   <Esc>Biz" => "z   ",
B_words: "iab cd  <Esc>Biz<Esc>Biy" => "yab zcd  ",
B_symbols: "iab(:)cd  <Esc>Biz<Esc>Biy" => "yzab(:)cd  ",

dw_middle: "iabc def<Esc>0dw" => "def",
dw_leading_space: "i  abc def<Esc>0dw" => "abc def",
dw_single_char: "ia b<Esc>0dw" => "b",
dw_cursor_middle: "iabc def<Esc>Bldw" => "abc d",
dw_end: "iabc<Esc>0dw" => "",

db_middle: "iabc def<Esc>db" => "abc f",
db_start: "iabc<Esc>0db" => "abc",
db_leading_space: "i  abc<Esc>db" => "  c",
db_single_char: "i a b<Esc>db" => " b",
db_single_char_end: "i a b <Esc>db" => " a  ",

d0_middle: "i abc def ghi<Esc>bbd0" => "def ghi",
d0_start: "iabc<Esc>0d0" => "abc",
d0_end: "iabc def <Esc>d0" => " ",
d0_empty: "d0" => "",

ddollar_start: "iabc def<Esc>0d$" => "",
ddollar_end: "iabc def<Esc>d$" => "abc de",
ddollar_middle: "iabc def<Esc>hhhhd$" => "ab",
ddollar_empty: "d$" => "",

dcaret_end: "i  abc<Esc>d^" => "  c",
dcaret_start: "iabc<Esc>0d^" => "abc",
dcaret_spaces_only: "i    <Esc>d^" => "   ",
dcaret_empty: "d^" => "",
dcaret_middle: "i abc def ghi<Esc>bbld^" => " ef ghi",

dinvalid: "d " => "",

dW: "iab  cd ef<Esc>0dW" => "cd ef",
dW_middle_no_right: "iab  cd ef<Esc>dW" => "ab  cd e",
dW_middle_right: "iab  cd ef<Esc><Right>dW" => "ab  cd e",

dB: "iab  cd ef<Esc>0<Right><Right>dB" => "  cd ef",
dB_space: "i  ab<Esc>0<Right>dB" => " ab",
dB_start: "iab<Esc>0dB" => "ab",

_f: "iabcabc<Esc>0fcaz" => "abczabc",
df: "iabcabc<Esc>0dfc" => "abc",
df_not_found: "iabc<Esc>0dfz" => "abc",
df_invalid: "iabc<Esc>0drib" => "babc",

_t: "iabcabc<Esc>0tcaz" => "abzcabc",
dt: "iabcabc<Esc>0dtc" => "cabc",
dt_not_found: "iabc<Esc>0dtz" => "abc",

_T: "iabcabc<Esc>Tcaz" => "abcazbc",
dT: "iabcabc<Esc>dTc" => "abcc",
dT_not_found: "iabc<Esc>dTz" => "abc",

_F: "iabcabc<Esc>Fcaz" => "abczabc",
dF: "iabcabc<Esc>dFc" => "abc",
dF_not_found: "iabc<Esc>dFz" => "abc",

e: "iabc def<Esc>0eaz" => "abcz def",
e_not_in_word: "i abc def<Esc>0eaz" => " abcz def",
e_symbols: "iabc, def<Esc>0eaz" => "abcz, def",
e_end: "iabc<Esc>eaz" => "abcz",
e_num_under: "ia0b_c2d, <Esc>0eaz" => "a0b_c2dz, ",
e_double_symbols: "iabc!!def <Esc>0ea.<Esc>ea.<Esc>ea." => "abc.!!.def. ",
e_end_of: "ia b<Esc>0eac" => "a bc",

E: "iabc def<Esc>0Eaz" => "abcz def",
E_not_in_word: "i abc def<Esc>0Eaz" => " abcz def",
E_symbols: "iabc, def<Esc>0Eaz" => "abc,z def",
E_end: "iabc<Esc>Eaz" => "abcz",
E_num_under: "ia0b_c2d, <Esc>0Eaz" => "a0b_c2d,z ",
E_double_symbols: "iabc!!def <Esc>0Ea.<Esc>Ea." => "abc!!def. .",
E_end_of: "ia b<Esc>0Eac" => "a bc",

de_space: "iabc def<Esc>0de" => " def",
de_symbol: "iabc!def<Esc>0de" => "!def",
de_symbol_word: "i(:)abc<Esc>0de" => "abc",
de_empty: "i   <Esc>0de" => "",
de_end: "iab(:) de<Esc>0de" => "(:) de",

dE_space: "iabc def<Esc>0dE" => " def",
dE_symbol: "iabc!def<Esc>0dE" => "",
dE_symbol_word: "i(:)abc<Esc>0dE" => "",
dE_empty: "i   <Esc>0dE" => "",
dE_end: "iab(:) de<Esc>0dE" => " de",

tilde: "ia<Esc>~" => "A",
tilde_double: "iabc<Esc>0~~" => "ABc",
tilde_too_many: "iab<Esc>0~~~" => "Ab",
tilde_invalid: "i(<Esc>~" => "(",
tilde_empty: "~" => "",

dd: "iab (pr )'<Esc>bbdd" => "",
D: "iab (pr )'<Esc>bbD" => "ab (",

g_ignore: "iabc<Esc>gxx" => "ab",

ge_empty: "gei." => ".",
ge_only_space: "i     <Esc>gei." => ".     ",
ge_in_word: "iabcd(:)<Esc>gea." => "abcd.(:)",
ge_whitespace: "iabcd   <Esc>gea." => "abcd.   ",
ge_single_whitespace: "iabcd <Esc>gea." => "abcd. ",
ge_words: "iabcd efgh<Esc>gea." => "abcd. efgh",
ge_one_word: "i   word<Esc>gei." => ".   word",
ge_no_space: "iabcdef<Esc>gei." => ".abcdef",

gE_empty: "gEi." => ".",
gE_only_space: "i     <Esc>gEi." => ".     ",
gE_in_word: "iabcd(:)<Esc>gEa." => "a.bcd(:)",
gE_whitespace: "iabcd   <Esc>gEa." => "abcd.   ",
gE_single_whitespace: "iabcd <Esc>gEa." => "abcd. ",
gE_words: "iabcd efgh<Esc>gEa." => "abcd. efgh",
gE_one_word: "i   word<Esc>gEi." => ".   word",
gE_no_space: "iabcdef<Esc>gEi." => ".abcdef",

);
